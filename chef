#!/bin/zsh

echo "====================================="
echo "1ï¸âƒ£ Launch Website Preview (Local)"
echo "2ï¸âƒ£ Prepare Website for Launch (Build)"
echo "3ï¸âƒ£ Publish Live Website (Cloudflare)"
echo "4ï¸âƒ£ Deep Clean & Reset Project"
echo "5ï¸âƒ£ Sync Local Repository with GitHub"
echo "6ï¸âƒ£ Sync with Builder.io"
echo "7ï¸âƒ£ Launch Builder.io Editor (Local)"
echo "====================================="
echo "Enter 1, 2, 3, 4, 5, 6, or 7: "
read option

case $option in
  1)
    echo "ğŸš€ Launching local website preview..."
    npm start
    ;;

  2)
    echo "ğŸ“¦ Building project for launch..."
    npm run build
    ;;

  3)
    echo "â˜ï¸ Deploying to Cloudflare Pages..."
    # Ensure the build exists
    if [ ! -d "./build" ]; then
      echo "âŒ Build folder not found. Please run option 2 first."
      exit 1
    fi

    # Deploy to Cloudflare Pages using wrangler
    DEPLOY_OUTPUT=$(wrangler pages deploy ./build --branch main --commit-dirty=true)

    echo "$DEPLOY_OUTPUT"

    # Extract the live URL from the deploy output (last URL with .pages.dev)
    LIVE_URL=$(echo "$DEPLOY_OUTPUT" | grep -o 'https://.*\.pages\.dev' | tail -n 1)

    if [ -n "$LIVE_URL" ]; then
      echo "ğŸŒ Opening live site: $LIVE_URL"
      # Open in default browser
      if [[ "$OSTYPE" == "darwin"* ]]; then
        open "$LIVE_URL"
      elif [[ "$OSTYPE" == "linux-gnu"* ]]; then
        xdg-open "$LIVE_URL"
      else
        echo "Please open this URL manually: $LIVE_URL"
      fi
    else
      echo "âŒ Could not detect live URL from deployment output."
    fi
    ;;

  4)
    echo "ğŸ”„ Performing deep clean..."
    rm -rf build node_modules/.cache
    ;;

  5)
    echo "ğŸ”„ Syncing with GitHub..."
    # Remove leftover locks and cached folders
    find . -name "*.lock" -type f -delete
    git rm -r --cached backups 2>/dev/null
    git rm -r --cached node_modules/.cache 2>/dev/null

    git add .

    # Commit only if there are changes
    if ! git diff-index --quiet HEAD; then
      git commit -m "Sync with GitHub: sanitize project structure"
    fi

    git push
    ;;

  6)
    echo "ğŸ”„ Syncing with Builder.io..."
    # Add Builder.io sync commands here
    ;;

  7)
    echo "ğŸš€ Launching Builder.io Editor locally..."
    # Add Builder.io local launch command here
    ;;

  *)
    echo "âŒ Invalid option. Exiting."
    ;;
esac
