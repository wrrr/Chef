#!/bin/bash
# =========================================================
# deploychefs
# Builds and deploys the Chefs2Table site to Cloudflare Pages
# =========================================================

PROJECT_DIR=~/Library/Mobile\ Documents/com~apple~CloudDocs/GitHub/chefs2table-prod

echo "ğŸš€ Starting Cloudflare deployment for Chefs2Table..."

# Navigate to the project directory
cd "$PROJECT_DIR" || {
    echo "âŒ Failed to navigate to project directory"
    exit 1
}

# Kill any local dev servers
PID=$(lsof -ti :3000)
if [ -n "$PID" ]; then
    echo "ğŸ§¹ Cleaning up local dev server on port 3000: $PID"
    kill -9 $PID
else
    echo "âœ… No local dev server running"
fi

# Install dependencies (optional but safe)
echo "ğŸ“¦ Installing dependencies..."
npm install

# Build production bundle
echo "ğŸ—ï¸  Building optimized production build..."
npm run build || {
    echo "âŒ Build failed!"
    exit 1
}

# Deploy to Cloudflare Pages
echo "ğŸŒ Deploying to Cloudflare Pages..."
wrangler pages deploy build --project-name=chefs2table-prod || {
    echo "âŒ Deployment failed!"
    exit 1
}

# Open your live site
echo "âœ… Deployment complete!"
echo "ğŸŒ Opening site: https://chefs2table-prod.pages.dev"
open "https://chefs2table-prod.pages.dev"

